import discord

class NationSelect(discord.ui.Select):
    def __init__(self, nations: list[str], selected: set[str], locked: bool,placeholder: str = None):
        if placeholder is None:
            placeholder = "Выберите игровые нации"
        
        options = []

        for n in nations:
            options.append(
                discord.SelectOption(
                    label=n,
                    value=n,
                    default=n in selected
                )
            )

        super().__init__(
            placeholder=placeholder,
            options=options,
            max_values=2,
            min_values=2,
			disabled=locked
        )

    async def callback(self, interaction: discord.Interaction):
        view: NationSelectView = self.view

        # обновляем общее состояние
        view.selected = set(self.values)

        # пересобираем меню
		
        view.locked = True
        view.refresh()

        await interaction.response.edit_message(view=view)


class NationSelectView(discord.ui.View):
    def __init__(self, nations: list[str],placeholder: str = None):
        super().__init__(timeout=None)
        self.nations = nations
        self.selected: set[str] = set()
        self.locked: bool = False
        if placeholder is None:
            placeholder = "Выберите игровые нации"
        self.placeholder = placeholder
        self.refresh()

    def refresh(self):
        self.clear_items()
        self.add_item(NationSelect(self.nations, self.selected, self.locked,self.placeholder))
